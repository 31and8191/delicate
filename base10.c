/*-*- compile-command: "/u01/grantham/gp2c/gp2c-0.0.11pl4/./config/missing "; -*-*/
#include <pari/pari.h>
#include<stdlib.h>
#define BASE 10
/*
GP;install("init_dd1","vp","init_dd1","./dd1.gp.so");
*/
void init_dd1(long prec);
/*End of prototype*/

static GEN c;
static GEN d;
static GEN isdd;
static GEN q;
static GEN p,M,A;
/*End of global vars*/

void
main(int argc,char *argv[])	  /* void */
{
  if(argc!=2)
{
    printf("I'd like to have an argument, please.\n");
    exit(99);
}
  system("date");
  int v;
  v=atoi(argv[1]);
  int prec=38;
  int k;
  pari_init(4000000000,100000);
  pari_sp ltop = avma;
  c = pol_x(fetch_user_var("c"));
  d = pol_x(fetch_user_var("d"));
  isdd = pol_x(fetch_user_var("isdd"));
  q = pol_x(fetch_user_var("q"));
  M = pol_x(fetch_user_var("M"));
  A = pol_x(fetch_user_var("A"));
  p = pol_x(fetch_user_var("p"));


  A = readseq("3528326425847773822389395528898135949821803821206481685232764867099715848491711075048249825842719447982446719650692681469167185364242708047744273006953369497885973852111885922135644541135275560735551498412069419673388848663829295086329650070259155306927946454982746923208204370756825539272640555645331720049936176994929852487420763747847985149326072917849176218832490519737086235660898533188578669874507310033747231218952960021747238646931110087385185400982068328205830267160618246969569986791309257311463383281671322714861802360450456423340486727123647522695623706133714153087583694034872540772283119623705460010262134217489111965135979334526634873434457956439952122381612194095482637960258511322209805088380900722888053591124833211890973473731168978388710875839069183609110235928234619251359379755940781995719099533903519835007137001977771540123112752588446024702398660504750565794087263464799053350879586537121835018346984697810886730329737356662398718404475322199655114558851359070310119607495874230510878552534745106753851724086326747841659385505519789277108218801716020702193661669521758562871472789429250702760283562238701163935923345585814471040355669525806557269326400907433045396883195102887136841108236962836121211225046644837579010095989973856477014450998622456667610714470885649217956437524707500344274398556842340078488492290690808474809086466994461723757102928965025088465706354490518738536780534979996369230758612165907165323528126294009218452439890721462719779363896018735851692799600104588622665701798680810706815981924595470861880457914674147357202766155790020642492036842076068766637899917893829620821922066273754977960617406248177847021245501046927326450955522353349492626364547905837155446352578979545024638023475085670726827993773073470561925931219126876050671065631918679844360690084031825807189281485569749669107400764779126101817002057645313157432381969722563030972626404218475626587491261130595048633857392499289284314507088244890757704826483760968916487467990700649363153913507039155789252386579439729264999174738010220087305885416694193449635291754868405836117881429580518593896226478292378255139871064538311319613486579154931498599439483243883867233227406805135111054206873890164097550379331007102807634706525699086170165777050243090334401686883038385538012145721635605105241481063632465252456291884113608618729225687308567234660213943614928764836387610820351141674922063041008403789760570871178197991449211912460253193728514976888167405956920921958763121807072031180294213256919698546012669625326129625818644805035732615443805212803994690013431588724913725782496130520955374348080087318004778198642490694909158121999298489373756496862806218294132587617725635195080920091857737853226961552413026327186767841099520830731608431517391813057815409831851122172365472899284090973336631936099529793047178958021911241385722497625634557529464980339209031421310536789814625114910428517307160640151987753137176901541040184800335028031580198481761424239421392978892217042141316851834106333360921645253743710687531513982513458128071137894648266637426540435147964208989122965001978675913052056033084320492822310339490502215893911591633546930549711754588201628961924835349744095868465891725800842924030140385686809573162345026423503333620343315311560461873709769552762759049836312734803008362536584085285031018599029809426593179054056052383542944188238787536182910733779511112825865372106147270449389635791730733849804996311798169603061156121595596102468945694583308100657742060955827638603240023828228102449786777781014903295891323538385471546369915144409998784412928006710855011086180380283009226757389509537620386288061928903927769968355306007632032774916819082159193026445880744463358817431352605851321454644068437836875621005428742860923338929351898190766353829619797239343109570635473616475765901238522040681692301879012265319049709759262181188993305170794380281908462266318703807400935718814351288787601501172695745141663121496257853694938729945679712053979408460721016937960839657699344056686655852581753");
  M = readseq("4275006237989699490158225569780322099133477436237271910866560053376123008483195387216343509295846776320028646396485518953629317331747692739535152985281796935470382061032067041631235451050832548303140396261648371280255748212536624063309501334672188260323338694637789064280442684643845059843100499815651794822581802205548029843769360174076754581007768280520336909767983699053631036745616042503638646384955375848834349616022261169247853256650973261158120427479762538544378318230044960195870063222427476374385271687754666121444053548977123569899677224907719834183823308276163787116108882535565097047965148182427778041865890082920499053859475849555188396291301187536968539560947559151857091524680699791492605194296627387003058615262800290825293642672924839909017608127624278921213980938055361491766428112271574173130330862464986013113217932435840585931057653304479652549934702742383048457860944925334862894095221344083016750676739962854066119990878238205765845954690962841862928268906804190010646347789883061869433828011485842537883160658823145630661704037744820800781526365758899888432882118501532333730794116867945176892935939602426953142679938492614750638862395895680343585818547264050599733486861318892010490600643989434515557586706596754601933875510479209283228479170159750628312074867381994151816870707444210623224707545964327011530311936439846713221150591151897976361110765250240546199804237267150178023614926826270950103782820328285392924017702039652589161067386884424163353499748849530089160989998209714221674657203813747141722356189765576301940693755424292700743325182920501890181807297921064181453865468814419128967120003572989574154755952920028073188189451502569395024964135662115761661577661510303525818757158257175370606350160626238293757073580690018560998302472896189105566570465945413430966106359120424527808427185068004506444601169666014104228068453133884387683545134677719230262005902054732025167384135830915707054602972249388718325992222063750588017173772554432918818062070418478171655959775154404476744215553778954336841288624753479072776496364258437637834757579872009263835484160587053852390744923809711527382644585115530413174004213356274026988341946209017902402969629442020217806954431120709820370117327028740420923288390842904392154472345853278834217616161526324379827914487059251737963889508527379146287517655296562507062947667691973992625353286796257439823516785229046424988289770951128621710099796436498202477996821049703197088169717194315634593742524423609738839722842324033813327786483024039799617040060960504543554387553159649827616999567256791264154407143744891913835442879474568954122469735262117711322033375025530409487329467565340666461557978268462572975847816707438671735719370726342218864434023307182150340434524213598734996085658674200917717932021636829263894827258834191633429007784468210198607297005652380205333430884415750320567398936866414582595277418136945279723585607032181342982991916945526477883612390937044018335827747459011488000072815073116850367826408627420346442912476508474685732747606403334396311192142409095604701262611594020972637240346284166958744975411540120860211810948792256724448091093102419355853759242432912230316574892835068581825581024153155894787674841301770801351621213323653265027998040155039548614767873520726239176906662277808653752320603407165204057607597263399741108858447672769465408096520094599051905634276672749945841490235443659396819927279745998601430621548652896857154659981726950399610558824483967667964878500863648723056348052971646019242557294431769384707445455242104271987754419153733692803118097560029372094294483609558080015310803223286340039335169680914239650430720733294056223195480388020623809655749128007953673290593076081904439549422102025466265244582561922094243664189751629004591829641617044333735590473857199943515810547517856832499484417508700416709353193159964739128830438207619097044145144837987746235138230464692645255530024472888996840855025465917059715575173780060093960071527322376776870418168121739894934666301822837441860113561998486");
  c = gen_0;
  {
    for(k=0; k<=10000000; k++)
    {
      pari_sp btop = avma;
      pari_sp bbot;
        

      if(k%101==v) 
      {
        {
          p = gadd(A, gmulsg(k, M));

          if (!gequal0(gispseudoprime(p, 0)))
          {
            pari_printf("%Ps (%d)\n", p,k);
          long l1;
          d = digits(p, stoi(BASE));
          isdd = gen_1;
          l1 = glength(d) - 1;
          {
            pari_sp btop = avma;
            GEN j = gen_0;
            for (j = gen_0; gcmpgs(j, l1) <= 0; j = gaddgs(j, 1))
            {
              {
                pari_sp btop = avma;
                long a;
                for (a = 0; a < BASE; ++a)
                {
                  if(!gequal0(isdd))
                  if (!gequalsg(a, gel(d, gtos(gsubsg(glength(d), j)))))
                  {
                    q = gadd(p, gmul(gsubsg(a, gel(d, gtos(gsubsg(glength(d), j)))), gpow(stoi(BASE), j, prec)));
                    if (!gequal0(gispseudoprime(q, 0)))
                    {
                      isdd = gen_0;
                      pari_printf("Bad: %Ps (%Ps,%d)\n", p,j,a);
                      system("date");
                    }
                  }
                  if (gc_needed(btop, 1))
                    gerepileall(btop, 2, &isdd, &q);
                }
              }
              if (gc_needed(btop, 1))
                gerepileall(btop, 3, &isdd, &j, &q);
            }
          }
          if (gequal1(isdd))
          {
            pari_printf("Good: %Ps\n", p);
            system("date");
            c = gaddgs(c, 1);
          }
        }
        }
           bbot = avma;
           gerepile(btop,bbot,p);
      }
    }
  }
  pari_printf("Total: %Ps\n", c);
  exit(0);
}

