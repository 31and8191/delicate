/*-*- compile-command: "/u01/grantham/gp2c/gp2c-0.0.11pl4/./config/missing "; -*-*/
#include <pari/pari.h>
#include<stdlib.h>
#define BASE 10
/*
GP;install("init_dd1","vp","init_dd1","./dd1.gp.so");
*/
void init_dd1(long prec);
/*End of prototype*/

static GEN c;
static GEN d;
static GEN isdd;
static GEN q;
static GEN p,M,A;
/*End of global vars*/

void
main(int argc,char *argv[])	  /* void */
{
  if(argc!=2)
{
    printf("I'd like to have an argument, please.\n");
    exit(99);
}
  system("date");
  int v;
  v=atoi(argv[1]);
  int prec=38;
  int k;
  pari_init(4000000000,100000);
  pari_sp ltop = avma;
  c = pol_x(fetch_user_var("c"));
  d = pol_x(fetch_user_var("d"));
  isdd = pol_x(fetch_user_var("isdd"));
  q = pol_x(fetch_user_var("q"));
  M = pol_x(fetch_user_var("M"));
  A = pol_x(fetch_user_var("A"));
  p = pol_x(fetch_user_var("p"));


  A = readseq("2053493664171343211591623956186108480969158047783641112653402948800477871037851332804548949999738781931852649572938900081422279859221385877082053148880071786461567696254100846086501223131455202062959112971324087310449528737165452354103357539132737885136872800789241710509593134251986831769950150071000195730144909731286168004731325445135325892975672854639061219003710954457143756926325491751718020100448238021976089243149566553987613000820584887871489139949935335427097441564618473807708529229305821425228138319620370101402167216716953384707478778509695186196903973162461887814440417868244713372133443107448793983386773633505859100858561169174604534235426776399194684618846678918148743267705995537608824453808597854145414393608216784422393544697485293768569503690940081530993958256171600663318408948710474694315296639786447257328556171075010824467683282804670593286341111214309753193438684506221801352860745525196351236437428343486201780600504181828946551777283329633062952672010565521169418861256080460365744930484426418418114159392667337398141080238941574104029658665404489622170158581590507900203667502524798670627762429323317912315393711115834529989436532426761478164784774252772096030825296917859159683428663491088752127570970823896070057423367128363435703183758650891686732151581509499230507633432268402596787054915114734440599393209596702296466156290150572876365878993748793967003793441746148684829971132129758985683815600704950704645970250100151296378535892288556770934689157631793986399807522978140120172808224146867283839125798047276012628935069227775894222550003358889907445038707238414519824184319448608309618271279172044367610578330098469060054931988781780550357179938625174972167246846236513905653467052372717191726797411819065489751121752522611299447597531388299630376655516344110731860405892505259661502229692358935873357576329331139210065701636842156301588040608699249762300439857529211421027675392677897764586929178869962287605422001320249386666847301302410357296703291325948595077790212103323873786723684028701481965065343164913498225006713309885477036237747712014702410288054061634762668965247386478862537701139036613087564921422511811573510421575067745982526396420896827261779522515753015312260532805832697692793887630949774373405782575672470281093940310843132842171117682597032215694168455750151078325436699681749906005608789787209204855945588864527533230253358025457666182795270254702202974210085070965710865155082836100599528444969619545151917871682881192807549577886382556227753617574323314923413651787873554026948250692501188184808332091251946864244639701869833354660010365477848395597021500047461477962418484965121974215568463869360531772339561737248938692137660930190897014812813342651487719738757901523753537743065781237800893843093278729417906681577330070801819356530262192088204255973162567138161536756086934820488518667316134819601798953359012430801470130463335609774936048194744800231837916849902466086275762721383471642762316656967727639964381218026463038808104014778595997031927160131104898499653456739528475202256248652286978096072508647425785618879379385150677827815853263869407623422136803555684998274602208435276793339377938163957904075258567032409249067185864783405490373177492115080855290582302942617782943253072778761631756970814131758723497475425741314055972981445845631442600719870190351686972164962011693553102191320564242393445619500777982085199747487806397202812329248349873704058634548943788558609299775836916934229795269947322697216337800976469288569934023152263234600146259743641897276155835300626330669445759597889934583164906139409335445304048310348744252668561485444500468715060604361813734655521990548954154688788282247409612324256074902083068103291880353479938539978096418875614336694794693958811256981812729259346584156719944555775584244024502126868135016715241796691038266731852976310896080318766563970619382381271442001651073262435239891573161276219502435937860924209766392310032715871774578807781594704777677711128701401645143921970059498588516575170793695618854467");
  M = readseq("6294918498227693322408408371564541873470460183438758268693680656056643678995116294956434973521204137205899663231860601416784067356495552486439159918444216478137017205090324495874141430791454223622556314521331030066914460950138988546673118248603839378481406024585300971048049903799215795654286437702472388958639287396408860628348545554128438885828304947519219134439201943693209031585913621273506933921513934098066988147260752241440800717231517456521496556772911920885895626860281874978496144152004645061715985253840181378381921022002551795669357320197989296104179253781018812822065801494253676713510630326556247011856448883857017978437635417321549237969863490413213563546891363555569787546898751782582279586903272873130545197877030392877753101235997350664915125073385451880984165657139738546419291901921843374865784802701015360238850402141797454053078258938775360902202115456270842711917069944473636840431454480615622367597602928274553325104554980327028700290899443918139566135955463870888039118607581755052113995114116235412744683976564586717763815484493291004105815480942904944746389123958901497087351989757469971275372785346108266038741270478976423066793687839265968451033811505435220902516845547212730221926869624950040257272017114784151314064392156959690700495290958238850575583882046499473506846119477269682152067790940810584732359168752936033253697969556246663438611480818580224090672882507524554107466445418419716054257176510400506380646649990993679089867773399856936692840243329286831743415312219045099167481798842454326510419570275698022848978015014482380130811364705859523400580183291577153839371045333776027595702896823006648106081094223276468358520980010402511318423465099055485285998177109863170483505750830985522188603105327703426628971620070620715232412977533741105408101440923392005145401986075987083044679804598791715318439850077059586450778238064439010992140491682210065716809008808261532961723624937800369652748143079303123942734691477728530437347452966812689182323262179912025811025434077058563059474248872463663670159808288309425811823071278462685204010088915545883928005913092270130460859231122041022783404541185894968699013759241217380471579612197223173293905752329275486533677327792448490071525528914948330773761200839071470088021266023812670832699049266612172073536586388909445944900398664181833027112549646308704382838123177467214708335663431258535410911590082540230617213361553809441028335157289781258718701037511576127529771737875597719833313739139712384207998960102386327111269598753649947180848964198117688637255501387038416790054960096067383367154499935997200780826561526453685513704161771446737464230844540085142073211364393523095152493514784826102038976696725527083704541192809907706744983812454962365638432702069920893778294006054127693196718108173844764576269086085211127113817809428042265360329516474061827725694511387943839092531100763147286251229497264895089629769987684910392576030565676920906656953923071852492729899527355248560297014474880409227524594866405467363980629282127906358494246352881091526249027840051461434498647671592397346663394332797943612778852319717728350025864734333269387066833472939893137881282931159771669935856885186484721423898664405398150990914476736961067454753727244198845038839758108600956032654398956954919929932074470043675156176994150954046240992317863769225731702072591107765015547083058362062606676912205522912033247738681425739865003983224206583641391085150783333104782995740613798598745302082770118788406195147369494034733129564166052408416576763885055574545677221864316663129767635955411343323314188902355648266339602867059541550559124106024355820328326981564462995007354281630859492156864056632446943965274844835340375496896928815467725066566386718400198232351580413097033878623892858978475524166893373230816517328067696604729120093734954996682653627973819054122711788572828333535955093155594980662133482166983188298537254470848543014339590590519545926744475243176350951125593683998097901162995915331875879158040703610680489930322701064411080753942");
  c = gen_0;
  {
    for(k=0; k<=10000000; k++)
    {
      pari_sp btop = avma;
      pari_sp bbot;
        

      if(k%101==v) 
      {
        {
          p = gadd(A, gmulsg(k, M));

          if (!gequal0(gispseudoprime(p, 0)))
          {
            pari_printf("%Ps (%d)\n", p,k);
          long l1;
          d = digits(p, stoi(BASE));
          isdd = gen_1;
          l1 = glength(d) - 1;
          {
            pari_sp btop = avma;
            GEN j = gen_0;
            for (j = gen_0; gcmpgs(j, l1) <= 0; j = gaddgs(j, 1))
            {
              {
                pari_sp btop = avma;
                long a;
                for (a = 0; a < BASE; ++a)
                {
                  if(!gequal0(isdd))
                  if (!gequalsg(a, gel(d, gtos(gsubsg(glength(d), j)))))
                  {
                    q = gadd(p, gmul(gsubsg(a, gel(d, gtos(gsubsg(glength(d), j)))), gpow(stoi(BASE), j, prec)));
                    if (!gequal0(gispseudoprime(q, 0)))
                    {
                      isdd = gen_0;
                      pari_printf("Bad: %Ps (%Ps,%d)\n", p,j,a);
                      system("date");
                    }
                  }
                  if (gc_needed(btop, 1))
                    gerepileall(btop, 2, &isdd, &q);
                }
              }
              if (gc_needed(btop, 1))
                gerepileall(btop, 3, &isdd, &j, &q);
            }
          }
          if (gequal1(isdd))
          {
            pari_printf("Good: %Ps\n", p);
            system("date");
            c = gaddgs(c, 1);
          }
        }
        }
           bbot = avma;
           gerepile(btop,bbot,p);
      }
    }
  }
  pari_printf("Total: %Ps\n", c);
  exit(0);
}

